{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Rainfall vs Statewide Storage with annotations and hoverable points",
  "autosize": {"type": "fit", "contains": "padding"},
  "width": "container",
  "height": 350,
  "params": [
    {"name": "pYearMin", "value": 2010, "bind": {"input": "range", "min": 2010, "max": 2025, "step": 1, "name": "Start Year: "}},
    {"name": "pYearMax", "value": 2025, "bind": {"input": "range", "min": 2010, "max": 2025, "step": 1, "name": "End Year: "}},
    {"name": "showRainfall", "value": true, "bind": {"input": "checkbox", "name": "Show â€“ Rainfall"}},
    {"name": "showStorage", "value": true, "bind": {"input": "checkbox", "name": "Show â€“ Storage"}}
  ],
  "layer": [
    {
      "data": {"url": "data/VIC_Monthly_Rainfall_2010_2025.csv"},
      "transform": [
        {"filter": "datum['Rainfall (mm)'] != 'MISSING'"},
        {"calculate": "toNumber(datum['Rainfall (mm)'])", "as": "Rainfall_num"},
        {"aggregate": [{"op": "mean", "field": "Rainfall_num", "as": "AvgRain_mm"}], "groupby": ["Year","Month"]},
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"filter": "showRainfall"}
      ],
      "mark": {"type": "line", "interpolate": "monotone", "strokeWidth": 3},
      "encoding": {
        "x": {"field": "Date", "type": "temporal", "axis": {"title": null, "format": "%Y", "grid": false}},
        "y": {"field": "AvgRain_mm", "type": "quantitative", "axis": {"title": "Rainfall (mm)", "titleColor": "#1565c0", "titleFontWeight": "bold", "grid": false}},
        "color": {"value": "#1565c0"}
      }
    },
    {
      "data": {"url": "data/VIC_Monthly_Rainfall_2010_2025.csv"},
      "transform": [
        {"filter": "datum['Rainfall (mm)'] != 'MISSING'"},
        {"calculate": "toNumber(datum['Rainfall (mm)'])", "as": "Rainfall_num"},
        {"aggregate": [{"op": "mean", "field": "Rainfall_num", "as": "AvgRain_mm"}], "groupby": ["Year","Month"]},
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"filter": "showRainfall"}
      ],
      "mark": {"type": "point", "filled": true, "size": 45, "color": "#1565c0"},
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {"field": "AvgRain_mm", "type": "quantitative"},
        "tooltip": [
          {"field": "Date", "type": "temporal", "format": "%b %Y"},
          {"field": "AvgRain_mm", "title": "Rainfall (mm)", "format": ".1f"}
        ]
      }
    },
    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"filter": "showStorage"}
      ],
      "mark": {"type": "line", "interpolate": "monotone", "strokeWidth": 3},
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {
          "field": "Statewide_Percent_Full",
          "type": "quantitative",
          "axis": {
            "title": "Storage (%)",
            "titleColor": "#2e7d32",
            "titleFontWeight": "bold",
            "orient": "right",
            "labelAlign": "left",
            "labelPadding": 4,
            "tickCount": 6,
            "offset": 10,
            "format": ".0f",
            "grid": false
          }
        },
        "color": {"value": "#2e7d32"}
      }
    },
    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"filter": "showStorage"}
      ],
      "mark": {"type": "point", "filled": true, "size": 45, "color": "#2e7d32"},
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {"field": "Statewide_Percent_Full", "type": "quantitative"},
        "tooltip": [
          {"field": "Date", "type": "temporal", "format": "%b %Y"},
          {"field": "Statewide_Percent_Full", "title": "Storage (%)", "format": ".1f"}
        ]
      }
    },
    {
      "data": {"url": "data/VIC_Monthly_Rainfall_2010_2025.csv"},
      "transform": [
        {"filter": "datum['Rainfall (mm)'] != 'MISSING'"},
        {"calculate": "toNumber(datum['Rainfall (mm)'])", "as": "Rainfall_num"},
        {"aggregate": [{"op": "mean", "field": "Rainfall_num", "as": "AvgRain_mm"}], "groupby": ["Year","Month"]},
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMin"}], "sort": [{"field": "AvgRain_mm", "order": "ascending"}]},
        {"filter": "datum.rMin == 1"}
      ],
      "mark": {"type": "rule", "strokeDash": [4,4], "strokeWidth": 2, "color": "#1565c0"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}}
    },
    {
      "data": {"url": "data/VIC_Monthly_Rainfall_2010_2025.csv"},
      "transform": [
        {"filter": "datum['Rainfall (mm)'] != 'MISSING'"},
        {"calculate": "toNumber(datum['Rainfall (mm)'])", "as": "Rainfall_num"},
        {"aggregate": [{"op": "mean", "field": "Rainfall_num", "as": "AvgRain_mm"}], "groupby": ["Year","Month"]},
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMax"}], "sort": [{"field": "AvgRain_mm", "order": "descending"}]},
        {"filter": "datum.rMax == 1"}
      ],
      "mark": {"type": "rule", "strokeWidth": 2, "color": "#1565c0"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}}
    },
    {
      "data": {"url": "data/VIC_Monthly_Rainfall_2010_2025.csv"},
      "transform": [
        {"filter": "datum['Rainfall (mm)'] != 'MISSING'"},
        {"calculate": "toNumber(datum['Rainfall (mm)'])", "as": "Rainfall_num"},
        {"aggregate": [{"op": "mean", "field": "Rainfall_num", "as": "AvgRain_mm"}], "groupby": ["Year","Month"]},
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMin"}], "sort": [{"field": "AvgRain_mm", "order": "ascending"}]},
        {"filter": "datum.rMin == 1"}
      ],
      "mark": {"type": "text", "align": "left", "dx": 6, "dy": -6, "color": "#1565c0", "fontWeight": "bold"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}, "y": {"field": "AvgRain_mm", "type": "quantitative"}, "text": {"value": "Min rain"}}
    },
    {
      "data": {"url": "data/VIC_Monthly_Rainfall_2010_2025.csv"},
      "transform": [
        {"filter": "datum['Rainfall (mm)'] != 'MISSING'"},
        {"calculate": "toNumber(datum['Rainfall (mm)'])", "as": "Rainfall_num"},
        {"aggregate": [{"op": "mean", "field": "Rainfall_num", "as": "AvgRain_mm"}], "groupby": ["Year","Month"]},
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMax"}], "sort": [{"field": "AvgRain_mm", "order": "descending"}]},
        {"filter": "datum.rMax == 1"}
      ],
      "mark": {"type": "text", "align": "left", "dx": 6, "dy": -6, "color": "#1565c0", "fontWeight": "bold"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}, "y": {"field": "AvgRain_mm", "type": "quantitative"}, "text": {"value": "Max rain"}}
    },
    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMin"}], "sort": [{"field": "Statewide_Percent_Full", "order": "ascending"}]},
        {"filter": "datum.rMin == 1"}
      ],
      "mark": {"type": "rule", "strokeDash": [4,4], "strokeWidth": 2, "color": "#2e7d32"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}}
    },
    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMax"}], "sort": [{"field": "Statewide_Percent_Full", "order": "descending"}]},
        {"filter": "datum.rMax == 1"}
      ],
      "mark": {"type": "rule", "strokeWidth": 2, "color": "#2e7d32"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}}
    },
    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMin"}], "sort": [{"field": "Statewide_Percent_Full", "order": "ascending"}]},
        {"filter": "datum.rMin == 1"}
      ],
      "mark": {"type": "text", "align": "left", "dx": 6, "dy": -6, "color": "#2e7d32", "fontWeight": "bold"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}, "y": {"field": "Statewide_Percent_Full", "type": "quantitative"}, "text": {"value": "Min storage"}}
    },
    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMax"}], "sort": [{"field": "Statewide_Percent_Full", "order": "descending"}]},
        {"filter": "datum.rMax == 1"}
      ],
      "mark": {"type": "text", "align": "left", "dx": 6, "dy": -6, "color": "#2e7d32", "fontWeight": "bold"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}, "y": {"field": "Statewide_Percent_Full", "type": "quantitative"}, "text": {"value": "Max storage"}}
    }
  ],
  "resolve": {"scale": {"y": "independent"}},
  "config": {
    "axisY": {
      "domain": true,
      "tickSize": 4,
      "labelFontSize": 11,
      "titleFontSize": 12,
      "titlePadding": 8
    }
  }
}
        {"calculate": "toNumber(datum['Rainfall (mm)'])", "as": "Rainfall_num"},
        {"aggregate": [{"op": "mean", "field": "Rainfall_num", "as": "AvgRain_mm"}], "groupby": ["Year","Month"]},
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"filter": "showRainfall"}
      ],
      "mark": {"type": "point", "filled": true, "size": 45, "color": "#1565c0"},
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {"field": "AvgRain_mm", "type": "quantitative"},
        "tooltip": [
          {"field": "Date", "type": "temporal", "format": "%b %Y"},
          {"field": "AvgRain_mm", "title": "Rainfall (mm)", "format": ".1f"}
        ]
      }
    },

    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"filter": "showStorage"}
      ],
      "mark": {"type": "line", "interpolate": "monotone", "strokeWidth": 3},
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {"field": "Statewide_Percent_Full", "type": "quantitative", "axis": {"title": "Storage (%)", "titleColor": "#2e7d32", "titleFontWeight": "bold", "orient": "right", "grid": false}},
        "color": {"value": "#2e7d32"}
      }
    },
    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"filter": "showStorage"}
      ],
      "mark": {"type": "point", "filled": true, "size": 45, "color": "#2e7d32"},
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {"field": "Statewide_Percent_Full", "type": "quantitative"},
        "tooltip": [
          {"field": "Date", "type": "temporal", "format": "%b %Y"},
          {"field": "Statewide_Percent_Full", "title": "Storage (%)", "format": ".1f"}
        ]
      }
    },

    {
      "data": {"url": "data/VIC_Monthly_Rainfall_2010_2025.csv"},
      "transform": [
        {"filter": "datum['Rainfall (mm)'] != 'MISSING'"},
        {"calculate": "toNumber(datum['Rainfall (mm)'])", "as": "Rainfall_num"},
        {"aggregate": [{"op": "mean", "field": "Rainfall_num", "as": "AvgRain_mm"}], "groupby": ["Year","Month"]},
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMin"}], "sort": [{"field": "AvgRain_mm", "order": "ascending"}]},
        {"filter": "datum.rMin == 1"}
      ],
      "mark": {"type": "rule", "strokeDash": [4,4], "strokeWidth": 2, "color": "#1565c0"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}}
    },
    {
      "data": {"url": "data/VIC_Monthly_Rainfall_2010_2025.csv"},
      "transform": [
        {"filter": "datum['Rainfall (mm)'] != 'MISSING'"},
        {"calculate": "toNumber(datum['Rainfall (mm)'])", "as": "Rainfall_num"},
        {"aggregate": [{"op": "mean", "field": "Rainfall_num", "as": "AvgRain_mm"}], "groupby": ["Year","Month"]},
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMax"}], "sort": [{"field": "AvgRain_mm", "order": "descending"}]},
        {"filter": "datum.rMax == 1"}
      ],
      "mark": {"type": "rule", "strokeWidth": 2, "color": "#1565c0"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}}
    },
    {
      "data": {"url": "data/VIC_Monthly_Rainfall_2010_2025.csv"},
      "transform": [
        {"filter": "datum['Rainfall (mm)'] != 'MISSING'"},
        {"calculate": "toNumber(datum['Rainfall (mm)'])", "as": "Rainfall_num"},
        {"aggregate": [{"op": "mean", "field": "Rainfall_num", "as": "AvgRain_mm"}], "groupby": ["Year","Month"]},
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMin"}], "sort": [{"field": "AvgRain_mm", "order": "ascending"}]},
        {"filter": "datum.rMin == 1"}
      ],
      "mark": {"type": "text", "align": "left", "dx": 6, "dy": -6, "color": "#1565c0", "fontWeight": "bold"},
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {"field": "AvgRain_mm", "type": "quantitative"},
        "text": {"value": "Min rain"}
      }
    },
    {
      "data": {"url": "data/VIC_Monthly_Rainfall_2010_2025.csv"},
      "transform": [
        {"filter": "datum['Rainfall (mm)'] != 'MISSING'"},
        {"calculate": "toNumber(datum['Rainfall (mm)'])", "as": "Rainfall_num"},
        {"aggregate": [{"op": "mean", "field": "Rainfall_num", "as": "AvgRain_mm"}], "groupby": ["Year","Month"]},
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMax"}], "sort": [{"field": "AvgRain_mm", "order": "descending"}]},
        {"filter": "datum.rMax == 1"}
      ],
      "mark": {"type": "text", "align": "left", "dx": 6, "dy": -6, "color": "#1565c0", "fontWeight": "bold"},
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {"field": "AvgRain_mm", "type": "quantitative"},
        "text": {"value": "Max rain"}
      }
    },

    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMin"}], "sort": [{"field": "Statewide_Percent_Full", "order": "ascending"}]},
        {"filter": "datum.rMin == 1"}
      ],
      "mark": {"type": "rule", "strokeDash": [4,4], "strokeWidth": 2, "color": "#2e7d32"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}}
    },
    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMax"}], "sort": [{"field": "Statewide_Percent_Full", "order": "descending"}]},
        {"filter": "datum.rMax == 1"}
      ],
      "mark": {"type": "rule", "strokeWidth": 2, "color": "#2e7d32"},
      "encoding": {"x": {"field": "Date", "type": "temporal"}}
    },
    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMin"}], "sort": [{"field": "Statewide_Percent_Full", "order": "ascending"}]},
        {"filter": "datum.rMin == 1"}
      ],
      "mark": {"type": "text", "align": "left", "dx": 6, "dy": -6, "color": "#2e7d32", "fontWeight": "bold"},
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {"field": "Statewide_Percent_Full", "type": "quantitative"},
        "text": {"value": "Min storage"}
      }
    },
    {
      "data": {"url": "data/VIC_Statewide_Storage_Percent_2010_2025.csv"},
      "transform": [
        {"calculate": "toDate(datum.Year + '-' + datum.Month + '-01')", "as": "Date"},
        {"filter": "year(datum.Date) >= pYearMin && year(datum.Date) <= pYearMax"},
        {"window": [{"op": "rank", "as": "rMax"}], "sort": [{"field": "Statewide_Percent_Full", "order": "descending"}]},
        {"filter": "datum.rMax == 1"}
      ],
      "mark": {"type": "text", "align": "left", "dx": 6, "dy": -6, "color": "#2e7d32", "fontWeight": "bold"},
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {"field": "Statewide_Percent_Full", "type": "quantitative"},
        "text": {"value": "Max storage"}
      }
    }
  ],

  "resolve": {"scale": {"y": "independent"}}
}
